<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gerador V2 — Logos automáticos</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
  /* ===== CSS CORRIGIDO para gerador_v2.html ===== */
:root{
  --bg:#F3F4F6;
  --card:#ffffff;
  --muted:#6b7280;
  --primary:#1E40AF;
  --accent:#FACC15;
  --shadow: 0 8px 28px rgba(16,24,40,0.08);
  --radius:12px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Inter, system-ui, Arial, sans-serif;
  background:var(--bg);
  color:#111827;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* header */
header{
  background:linear-gradient(90deg,#123c8a,#1e40af);
  color:white;
  padding:18px 20px;
  text-align:center;
}
header h1{font-family:Poppins,Inter;margin:0;font-size:18px}

/* wrapper */
.wrap{max-width:1150px;margin:22px auto;padding:18px}

/* top area */
.top{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between}
.input-group{display:flex;gap:8px;align-items:center}
.input-group input[type="text"]{
  min-width:320px;padding:10px 12px;border-radius:10px;border:1px solid #e6e9ee;background:white;font-size:1rem;
}
.btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
.btn.primary{background:var(--primary);color:#fff;box-shadow:0 6px 18px rgba(30,64,175,0.12)}
.btn.ghost{background:transparent;border:1px solid #d1d5db;color:#111827}

/* hint */
.hint{color:var(--muted);font-size:0.9rem;margin-top:8px}

/* CARDS layout: responsive */
.cards{
  margin-top:18px;
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap:18px;
}

/* Card */
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:stretch;
  min-height:220px;
}

/* preview area inside each card */
.logo-box{
  width:100%;
  height:160px;
  min-height:120px;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(180deg,#fff,#fbfdff);
  border:1px dashed rgba(30,64,175,0.06);
  overflow:hidden; /* important */
  padding:8px;
}

/* Make injected SVG scale to fit box */
.logo-box svg{
  width:100%;
  height:100%;
  display:block;
  /* preserveAspectRatio is controlled in the SVG viewBox; this ensures fill */
  max-width:100%;
  max-height:100%;
}

/* Brand + slogan */
.logo-inline{display:flex;flex-direction:column;align-items:flex-start;gap:6px}
.logo-brand{
  font-weight:700;
  font-size:1.05rem;
  line-height:1.1;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:100%;
}
.logo-slogan{
  color:var(--muted);
  font-size:0.9rem;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:100%;
}

/* actions area */
.card-actions{display:flex;gap:8px;justify-content:space-between;align-items:center}
.card-meta{color:var(--muted);font-size:0.9rem}
.card-actions .btn{padding:8px 10px;font-size:0.9rem;border-radius:8px}

/* editor panel (fixed) */
.panel{
  position:fixed;
  right:20px;
  bottom:20px;
  background:var(--card);
  padding:14px;
  border-radius:12px;
  box-shadow:var(--shadow);
  width:320px;
  max-width:92%;
  display:none;
  flex-direction:column;
  gap:10px;
  z-index:1000;
  transition:transform .18s ease, opacity .18s ease;
  transform:translateY(8px);
  opacity:0;
}
.panel.show{display:flex;transform:translateY(0);opacity:1}
.panel h3{margin:0;font-family:Poppins;font-size:16px}

/* form rows inside panel */
.row{display:flex;gap:8px;align-items:center}
.row input[type="color"]{width:48px;height:40px;padding:0;border-radius:8px;border:none}
.row select, .row input[type="text"]{flex:1;padding:8px 10px;border-radius:8px;border:1px solid #e6e9ee}

/* small screens */
@media (max-width:1000px){
  .input-group input[type="text"]{min-width:200px}
}
@media (max-width:640px){
  .top{flex-direction:column;align-items:stretch}
  .input-group{width:100%}
  .panel{right:10px;left:10px;width:auto}
}

/* accessibility focus */
button:focus, input:focus, select:focus{
  outline:3px solid rgba(30,64,175,0.12);
  outline-offset:2px;
  border-color:rgba(30,64,175,0.25);
}

/* Tiny polish */
.card:hover{transform:translateY(-4px);transition:transform .18s ease}

</style>
</head>
<body>
  <header>
    <h1>Gerador Automático de Logotipos — V2</h1>
  </header>

  <div class="wrap">
    <div class="top">
      <div>
        <strong>Digite o nome da marca</strong>
        <div class="hint">Com um clique criamos várias propostas — escolha e edite a que gostar.</div>
      </div>

      <div class="input-group" role="search">
        <input id="brandInput" type="text" placeholder="Ex: Padaria Bom Pão" value="Minha Marca">
        <button id="genBtn" class="btn primary">Gerar 6 variações</button>
        <button id="resetBtn" class="btn ghost">Reset</button>
      </div>
    </div>

    <div id="cards" class="cards" aria-live="polite" style="margin-top:18px">
      <!-- cards gerados aqui -->
    </div>
  </div>

  <!-- editor panel -->
  <aside id="editorPanel" class="panel" aria-hidden="true">
    <h3>Editar proposta</h3>
    <div class="row">
      <input id="editColor" type="color" value="#1E40AF">
      <select id="editLayout">
        <option value="left">Ícone à esquerda</option>
        <option value="stack">Ícone acima</option>
        <option value="badge">Badge</option>
      </select>
    </div>
    <div class="row">
      <select id="editFont">
        <option value="Poppins">Poppins (negrito)</option>
        <option value="Inter">Inter (limpo)</option>
        <option value="Georgia">Georgia (serif)</option>
        <option value="Arial">Arial</option>
      </select>
    </div>
    <div class="row">
      <input id="editSlogan" type="text" placeholder="Slogan (opcional)">
    </div>

    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button id="saveEdit" class="btn primary">Salvar</button>
      <button id="closeEdit" class="btn ghost">Fechar</button>
    </div>
  </aside>

<script>
/*
  Gerador V2 - lógica:
  - Ao clicar "Gerar 6 variações" cria 6 propostas com variações automáticas (layout, paleta, fonte)
  - Cada card tem: preview (SVG), nome, ação Editar, Baixar PNG, Baixar SVG
  - Ao Editar abre painel que altera a variante (in-memory)
  - Exporta SVG (vetor) e PNG (converte SVG->canvas->dataURL)
*/

// util: seeded random based on brand + index -> deterministic suggestions
function seededRand(seed){
  let h = 2166136261 >>> 0;
  for (let i=0;i<seed.length;i++) h = Math.imul(h ^ seed.charCodeAt(i), 16777619);
  return function(){
    h += 0x6D2B79F5;
    let t = Math.imul(h ^ h >>> 15, 1 | h);
    t ^= t + Math.imul(t ^ t >>> 7, 61 | t);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  }
}

// palettes presets
const PALETTES = [
  ['#1E40AF','#FACC15','#FBFBFD'],
  ['#0F172A','#06B6D4','#E6FFFA'],
  ['#0B6623','#A7F3D0','#FFFFFF'],
  ['#7C3AED','#C7B8FF','#FFF5F8'],
  ['#B45309','#FFEDD5','#FFFFFF'],
  ['#111827','#94A3B8','#F8FAFC']
];

// simple icon types -> produce small SVG fragment
function iconFragment(kind, size, fill){
  const s = size;
  if(kind === 'circle'){
    return `<circle cx="${s/2}" cy="${s/2}" r="${s*0.42}" fill="${fill}" />`;
  }
  if(kind === 'leaf'){
    return `<path d="M ${s*0.12} ${s*0.64} C ${s*0.36} ${s*0.08}, ${s*0.84} ${s*0.08}, ${s*0.84} ${s*0.64} C ${s*0.5} ${s*0.64}, ${s*0.38} ${s*0.96}, ${s*0.12} ${s*0.64}" fill="${fill}" />`;
  }
  if(kind === 'shop'){
    return `<rect x="${s*0.12}" y="${s*0.2}" width="${s*0.76}" height="${s*0.58}" rx="${s*0.06}" fill="${fill}" /><rect x="${s*0.3}" y="${s*0.34}" width="${s*0.4}" height="${s*0.28}" fill="#fff" />`;
  }
  if(kind === 'star'){
    const pts = [
      [0.5,0.06],[0.62,0.36],[0.95,0.36],[0.69,0.58],
      [0.81,0.9],[0.5,0.7],[0.19,0.9],[0.31,0.58],[0.05,0.36],[0.38,0.36]
    ].map(p => `${p[0]*s},${p[1]*s}`).join(' ');
    return `<polygon points="${pts}" fill="${fill}" />`;
  }
  if(kind === 'bolt'){
    return `<path d="M ${s*0.36} ${s*0.08} L ${s*0.72} ${s*0.08} L ${s*0.44} ${s*0.56} L ${s*0.8} ${s*0.56} L ${s*0.24} ${s*0.96} L ${s*0.36} ${s*0.56} L ${s*0.04} ${s*0.56} Z" fill="${fill}" />`;
  }
  return `<circle cx="${s/2}" cy="${s/2}" r="${s*0.42}" fill="${fill}" />`;
}

// build full SVG string for a variant
function buildSVG({brand, slogan, color, accent, layout, iconKind, font, size}){
  const W = size, H = size;
  const padding = Math.round(W*0.06);
  const iconSize = Math.round(W*0.28);
  const brandEsc = brand ? escapeHtml(brand) : '';
  const sloganEsc = slogan ? escapeHtml(slogan) : '';
  const textColor = color;
  let inner = '';

  if(layout === 'left'){
    const iconX = padding;
    const iconY = Math.round((H - iconSize) / 2);
    const textX = iconX + iconSize + Math.round(W*0.04);
    inner += `<g transform="translate(${iconX},${iconY})">${iconFragment(iconKind, iconSize, accent)}</g>`;
    inner += `<g transform="translate(${textX},${Math.round(H/2) - 12})">`;
    inner += `<text x="0" y="-6" font-family="${font}" font-weight="700" font-size="${Math.round(W*0.08)}" fill="${textColor}">${brandEsc}</text>`;
    if(sloganEsc) inner += `<text x="0" y="${Math.round(W*0.06)}" font-family="${font}" font-weight="400" font-size="${Math.round(W*0.036)}" fill="#374151">${sloganEsc}</text>`;
    inner += `</g>`;
  } else if(layout === 'stack'){
    const iconX = Math.round((W - iconSize) / 2);
    const iconY = padding;
    inner += `<g transform="translate(${iconX},${iconY})">${iconFragment(iconKind, iconSize, accent)}</g>`;
    const textY = iconY + iconSize + Math.round(W*0.03);
    inner += `<g transform="translate(${Math.round(W/2)},${textY})">`;
    inner += `<text x="0" y="0" font-family="${font}" font-weight="700" font-size="${Math.round(W*0.1)}" fill="${textColor}" text-anchor="middle">${brandEsc}</text>`;
    if(sloganEsc) inner += `<text x="0" y="${Math.round(W*0.06)}" font-family="${font}" font-weight="400" font-size="${Math.round(W*0.04)}" fill="#374151" text-anchor="middle">${sloganEsc}</text>`;
    inner += `</g>`;
  } else { // badge
    const center = Math.round(W/2);
    const badgeRadius = Math.round(iconSize*0.9);
    const iconY = Math.round(H*0.22);
    inner += `<g transform="translate(${center - badgeRadius/2}, ${iconY - badgeRadius/2})">`;
    inner += `<circle cx="${badgeRadius/2}" cy="${badgeRadius/2}" r="${badgeRadius/2}" fill="${accent}" />`;
    inner += `<g transform="translate(${badgeRadius*0.18}, ${badgeRadius*0.18})">${iconFragment(iconKind, Math.round(badgeRadius*0.64), '#fff')}</g>`;
    inner += `</g>`;
    const textY = iconY + badgeRadius/2 + Math.round(W*0.06);
    inner += `<g transform="translate(${center}, ${textY})">`;
    inner += `<text x="0" y="0" font-family="${font}" font-weight="700" font-size="${Math.round(W*0.085)}" fill="${textColor}" text-anchor="middle">${brandEsc}</text>`;
    if(sloganEsc) inner += `<text x="0" y="${Math.round(W*0.06)}" font-family="${font}" font-weight="400" font-size="${Math.round(W*0.035)}" fill="#374151" text-anchor="middle">${sloganEsc}</text>`;
    inner += `</g>`;
  }

  const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${W}" height="${H}" viewBox="0 0 ${W} ${H}">
    <rect width="100%" height="100%" fill="#ffffff"/>
    ${inner}
  </svg>`;
  return svg;
}

// helper escape
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

// svg -> dataURL PNG
function svgToPngDataUrl(svg, w, h, cb){
  const blob = new Blob([svg], {type:'image/svg+xml;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const img = new Image();
  img.onload = () => {
    try {
      const canvas = document.createElement('canvas');
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,w,h);
      ctx.drawImage(img,0,0,w,h);
      URL.revokeObjectURL(url);
      cb(null, canvas.toDataURL('image/png'));
    } catch(err){ cb(err); }
  };
  img.onerror = (e)=> cb(new Error('Erro ao carregar SVG: '+e));
  img.src = url;
}

// create 6 proposals
function generateProposals(brand){
  const seedSrc = brand.trim().toLowerCase();
  const rnd = seededRand(seedSrc);
  const proposals = [];
  for(let i=0;i<6;i++){
    const r = rnd();
    const palette = PALETTES[Math.floor(r * PALETTES.length)];
    const accent = palette[0];
    const altAccent = palette[1] || '#000';
    // choose layout and icon deterministically
    const layouts = ['left','stack','badge'];
    const icons = ['circle','leaf','shop','star','bolt'];
    const fonts = ['Poppins','Inter','Georgia','Arial'];
    const layout = layouts[Math.floor(rnd()*layouts.length)];
    const icon = icons[Math.floor(rnd()*icons.length)];
    const font = fonts[Math.floor(rnd()*fonts.length)];
    const slogan = (rnd() > 0.6) ? 'Slogan opcional' : '';
    proposals.push({
      id: 'p'+i,
      brand,
      slogan,
      color: accent,
      accent: altAccent,
      layout,
      iconKind: icon,
      font,
      size: 800
    });
  }
  return proposals;
}

// render a card
function renderCard(prop, index){
  const container = document.createElement('div');
  container.className = 'card';
  container.dataset.proposalId = prop.id;

  // SVG preview small
  const svgPreview = buildSVG({...prop, size:300});
  const previewBox = document.createElement('div');
  previewBox.className = 'logo-box';
  previewBox.innerHTML = svgPreview;
  container.appendChild(previewBox);

  // brand text
  const brandDiv = document.createElement('div');
  brandDiv.innerHTML = `<div class="logo-inline"><div class="logo-brand">${escapeHtml(prop.brand)}</div></div>
                        <div class="logo-slogan">${escapeHtml(prop.slogan)}</div>`;
  container.appendChild(brandDiv);

  // actions
  const actions = document.createElement('div');
  actions.className = 'card-actions';
  const meta = document.createElement('div');
  meta.className = 'card-meta';
  meta.textContent = `${prop.layout.toUpperCase()} • ${prop.font}`;
  actions.appendChild(meta);

  const right = document.createElement('div');
  right.style.display='flex';
  right.style.gap='8px';

  const editBtn = document.createElement('button'); editBtn.className='btn ghost'; editBtn.textContent='Editar';
  const svgBtn = document.createElement('button'); svgBtn.className='btn ghost'; svgBtn.textContent='SVG';
  const pngBtn = document.createElement('button'); pngBtn.className='btn primary'; pngBtn.textContent='PNG';

  right.appendChild(editBtn); right.appendChild(svgBtn); right.appendChild(pngBtn);
  actions.appendChild(right);
  container.appendChild(actions);

  // attach behaviours
  editBtn.addEventListener('click', ()=> openEditor(prop, container, index));
  svgBtn.addEventListener('click', ()=> {
    const svg = buildSVG({...prop, size:1200});
    const blob = new Blob([svg], {type:'image/svg+xml;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = (prop.brand||'logo')+'.svg'; a.click();
    setTimeout(()=>URL.revokeObjectURL(url),2000);
  });
  pngBtn.addEventListener('click', ()=> {
    const size = prop.size||1200;
    const svg = buildSVG({...prop, size:size});
    svgToPngDataUrl(svg, size, size, (err, dataUrl) =>{
      if(err){ console.error(err); alert('Erro ao gerar PNG. Veja console.'); return; }
      const a = document.createElement('a'); a.href = dataUrl; a.download = (prop.brand||'logo')+'.png'; a.click();
    });
  });

  return container;
}

// editor panel operations
let currentEdit = null; // {prop,index,cardElem}
function openEditor(prop, cardElem, index){
  currentEdit = {prop, cardElem, index};
  const panel = document.getElementById('editorPanel');
  document.getElementById('editColor').value = prop.color || '#1E40AF';
  document.getElementById('editLayout').value = prop.layout || 'left';
  document.getElementById('editFont').value = prop.font || 'Poppins';
  document.getElementById('editSlogan').value = prop.slogan || '';
  panel.classList.add('show');
  panel.setAttribute('aria-hidden','false');
}

function closeEditor(){
  currentEdit = null;
  const panel = document.getElementById('editorPanel');
  panel.classList.remove('show');
  panel.setAttribute('aria-hidden','true');
}

document.getElementById('closeEdit').addEventListener('click', closeEditor);

// save changes and re-render card
document.getElementById('saveEdit').addEventListener('click', ()=>{
  if(!currentEdit) return;
  const prop = currentEdit.prop;
  prop.color = document.getElementById('editColor').value;
  prop.layout = document.getElementById('editLayout').value;
  prop.font = document.getElementById('editFont').value;
  prop.slogan = document.getElementById('editSlogan').value;
  // re-render the specific card in place
  const cards = document.getElementById('cards');
  const old = currentEdit.cardElem;
  const newCard = renderCard(prop, currentEdit.index);
  cards.replaceChild(newCard, old);
  closeEditor();
});

// generate UI
function renderAll(proposals){
  const cards = document.getElementById('cards');
  cards.innerHTML = '';
  proposals.forEach((p,i) => {
    const card = renderCard(p, i);
    cards.appendChild(card);
  });
}

// actions
document.getElementById('genBtn').addEventListener('click', ()=>{
  const brand = document.getElementById('brandInput').value.trim() || 'Minha Marca';
  const props = generateProposals(brand);
  // keep them in memory on element (basic)
  window._proposals = props;
  renderAll(props);
});

document.getElementById('resetBtn').addEventListener('click', ()=>{
  document.getElementById('brandInput').value = '';
  document.getElementById('cards').innerHTML = '';
});

// generate on Enter key in input
document.getElementById('brandInput').addEventListener('keydown', (e)=>{
  if(e.key === 'Enter'){ e.preventDefault(); document.getElementById('genBtn').click(); }
});

// initial generate for demo
document.getElementById('genBtn').click();
</script>
</body>
</html>
